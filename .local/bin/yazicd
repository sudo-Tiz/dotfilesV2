#!/bin/bash
tmp="$(mktemp -uq)"
trap 'rm -f $tmp >/dev/null 2>&1 && trap - HUP INT QUIT TERM PWR EXIT' HUP INT QUIT TERM PWR EXIT
yazi --cwd-file "$tmp" "$@"
if [ -f "$tmp" ]; then
  dir="$(cat "$tmp")"
  [ -d "$dir" ] && [ "$dir" != "$(pwd)" ] && cd "$dir" && $SHELL
fi
